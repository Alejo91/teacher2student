{% extends "base_with_navigation.html" %}
{% load floppyforms i18n staticfiles %}
{% block content %}
  <link href="{% static 'css/list.css' %}" rel="stylesheet" type='text/css'>
<div class="container">
  <div class="row">
      <h3> {% trans "Assign students for" %} {{ homework.title }}</h3>
    <div class="col-md-3">
      <table class="table table-striped table-bordered">
        <thead>
          <tr>
            <th>{% trans "Student" %}</th>
            <th>{% trans "Action" %}</th>
          </tr>
        </thead>
        <tbody>
        <tbody>
          {% for student in students %}
          <tr>
            <td>{{ student.first_name }} {{ student.last_name }}</td>
            <td>
              {% if homework in student.assigned_homeworks.all %}
              <button id="{{ student.id }}" class="btn btn-md btn-danger remove">
                {% trans "Remove" %}
              </button>
              {% else %}
              <button id="{{ student.id }}" class="btn btn-md btn-info add">
                {% trans "Add" %}
              </button>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
{% block script %}
<script type="text/javascript" src="{% static 'js/django-csrf-tools.js' %}"></script>
<script>
  $(document).ready(function () {
    function toogle_class(button) {
    // Toogle button style and text
  		console.log(button);
  		if (button.hasClass('remove')) {
        button.removeClass('remove');
        button.removeClass('btn-danger');
		  	button.addClass('btn-info');
		  	button.addClass('add');
		  	button.text('Assign');
  		}
  		else {
			button.removeClass('add');
			button.removeClass('btn-info');
		  	button.addClass('btn-danger');
		  	button.addClass('remove');
		  	button.text('Remove');
  		}
  	};
  	function post_assign_data(url, student, button) {
    // Send post data for Assign/Remove student to Homework 
  		$.ajax({
	        url : url, // the endpoint
	        type : 'POST', // http method
	        data : { 'homework_id': {{ homework.id }}, 'student_id': student}, // send homework id and user id
	        success : function(result) {
	           console.log(result);
	           toogle_class(button);
	        },
	        error : function(xhr,errmsg,err) {
	            console.log(xhr.status + ': ' + xhr.responseText);
	        }
	    });
  	}
    $(".add").click(function() {
      // Assign student to homework
      var student = $(this).attr('id')
      console.log('Add');
      console.log(student);
      post_assign_data("{% url 'homework:add_student' %}", student, $(this))
    });
    $(".remove").click(function() {
      // Remove student to homework
      var student = $(this).attr('id')
      console.log('Remove');
      post_assign_data("{% url 'homework:remove_student' %}", student, $(this))
      
    });

  });
</script>
{% endblock %}
